const data = {"Assault Rifle Single Shot":{"Armor 0":{"1: cqc 0-6m":15.7066,"2: close 7-12m":17.52,"3: medium 13-25m":17.487,"4: ideal 26-50m":17.5151,"5: far 51-100m":17.4734,"6: extreme 101-200m":10.496,"7: extreme ++ 201-400m":1.7031,"8: extreme +++ 400-800m":0},"Armor 4":{"1: cqc 0-6m":12.1095,"2: close 7-12m":13.4693,"3: medium 13-25m":13.4147,"4: ideal 26-50m":13.5337,"5: far 51-100m":13.4812,"6: extreme 101-200m":8.1355,"7: extreme ++ 201-400m":1.322,"8: extreme +++ 400-800m":0},"Armor 7":{"1: cqc 0-6m":9.4388,"2: close 7-12m":10.5676,"3: medium 13-25m":10.5109,"4: ideal 26-50m":10.4993,"5: far 51-100m":10.5136,"6: extreme 101-200m":6.3263,"7: extreme ++ 201-400m":1.0053,"8: extreme +++ 400-800m":0},"Armor 11":{"1: cqc 0-6m":5.8476,"2: close 7-12m":6.5806,"3: medium 13-25m":6.592,"4: ideal 26-50m":6.4747,"5: far 51-100m":6.5765,"6: extreme 101-200m":3.9267,"7: extreme ++ 201-400m":0.6658,"8: extreme +++ 400-800m":0},"Armor 12":{"1: cqc 0-6m":5.0321,"2: close 7-12m":5.6282,"3: medium 13-25m":5.6519,"4: ideal 26-50m":5.6173,"5: far 51-100m":5.6047,"6: extreme 101-200m":3.3458,"7: extreme ++ 201-400m":0.5503,"8: extreme +++ 400-800m":0},"Armor 13":{"1: cqc 0-6m":4.2499,"2: close 7-12m":4.7457,"3: medium 13-25m":4.7595,"4: ideal 26-50m":4.6938,"5: far 51-100m":4.6838,"6: extreme 101-200m":2.8102,"7: extreme ++ 201-400m":0.47,"8: extreme +++ 400-800m":0},"Armor 15":{"1: cqc 0-6m":2.7596,"2: close 7-12m":3.1306,"3: medium 13-25m":3.081,"4: ideal 26-50m":3.1032,"5: far 51-100m":3.068,"6: extreme 101-200m":1.881,"7: extreme ++ 201-400m":0.3185,"8: extreme +++ 400-800m":0},"Armor 18":{"1: cqc 0-6m":1.1243,"2: close 7-12m":1.2801,"3: medium 13-25m":1.3308,"4: ideal 26-50m":1.3159,"5: far 51-100m":1.2595,"6: extreme 101-200m":0.7673,"7: extreme ++ 201-400m":0.1392,"8: extreme +++ 400-800m":0}},"Assault Rifle Autofire":{"Armor 0":{"1: cqc 0-6m":9.2091,"2: close 7-12m":14.6657,"3: medium 13-25m":22.9653,"4: ideal 26-50m":14.8198,"5: far 51-100m":1.4082,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 4":{"1: cqc 0-6m":7.4788,"2: close 7-12m":12.2518,"3: medium 13-25m":19.4343,"4: ideal 26-50m":12.1879,"5: far 51-100m":1.0004,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 7":{"1: cqc 0-6m":6.3157,"2: close 7-12m":10.5463,"3: medium 13-25m":16.8019,"4: ideal 26-50m":10.6234,"5: far 51-100m":0.6991,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 11":{"1: cqc 0-6m":4.7822,"2: close 7-12m":8.4537,"3: medium 13-25m":13.5733,"4: ideal 26-50m":8.3161,"5: far 51-100m":0.37,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 12":{"1: cqc 0-6m":4.4689,"2: close 7-12m":7.8155,"3: medium 13-25m":12.4696,"4: ideal 26-50m":7.6819,"5: far 51-100m":0.3048,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 13":{"1: cqc 0-6m":4.1039,"2: close 7-12m":7.1625,"3: medium 13-25m":11.5777,"4: ideal 26-50m":7.216,"5: far 51-100m":0.2427,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 15":{"1: cqc 0-6m":3.4823,"2: close 7-12m":6.1814,"3: medium 13-25m":10.0494,"4: ideal 26-50m":6.2897,"5: far 51-100m":0.1433,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 18":{"1: cqc 0-6m":2.699,"2: close 7-12m":4.8478,"3: medium 13-25m":8.2103,"4: ideal 26-50m":4.9307,"5: far 51-100m":0.0614,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0}},"Assault Rifle Targeted Shot":{"Armor 0":{"1: cqc 0-6m":10.215,"2: close 7-12m":13.722,"3: medium 13-25m":17.2834,"4: ideal 26-50m":24.3182,"5: far 51-100m":17.2714,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 4":{"1: cqc 0-6m":8.1512,"2: close 7-12m":11.0516,"3: medium 13-25m":13.4922,"4: ideal 26-50m":18.9414,"5: far 51-100m":13.5376,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 7":{"1: cqc 0-6m":6.491,"2: close 7-12m":8.5998,"3: medium 13-25m":10.5916,"4: ideal 26-50m":14.8268,"5: far 51-100m":10.684,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 11":{"1: cqc 0-6m":4.039,"2: close 7-12m":5.2294,"3: medium 13-25m":6.5906,"4: ideal 26-50m":9.2174,"5: far 51-100m":6.4934,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 12":{"1: cqc 0-6m":3.3748,"2: close 7-12m":4.392,"3: medium 13-25m":5.6446,"4: ideal 26-50m":7.8236,"5: far 51-100m":5.6766,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 13":{"1: cqc 0-6m":2.8368,"2: close 7-12m":3.6832,"3: medium 13-25m":4.818,"4: ideal 26-50m":6.6072,"5: far 51-100m":4.8612,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 15":{"1: cqc 0-6m":1.8646,"2: close 7-12m":2.4352,"3: medium 13-25m":3.0546,"4: ideal 26-50m":4.4012,"5: far 51-100m":3.1554,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0},"Armor 18":{"1: cqc 0-6m":0.7216,"2: close 7-12m":1.0754,"3: medium 13-25m":1.2378,"4: ideal 26-50m":1.8416,"5: far 51-100m":1.2508,"6: extreme 101-200m":0,"7: extreme ++ 201-400m":0,"8: extreme +++ 400-800m":0}}}

function generateHeatMapTable(tableId, chartTitle, chartData) {
    const table = document.getElementById(tableId);
    table.innerHTML = '';
    const armorLevels = Object.keys(chartData[chartTitle]);
    const rangeLabels = Object.keys(chartData[chartTitle]["Armor 0"]);

    // Create table header
    const thead = table.createTHead();
    const headerRow = thead.insertRow();
    headerRow.insertCell().textContent = "Range / Armor";
    for (const armorLevel of armorLevels) {
        const th = document.createElement('th');
        th.textContent = armorLevel.replace("Armor ", "");
        headerRow.appendChild(th);

    }
    const tbody = table.createTBody();
    // Create table rows
    for (const rangeLabel of rangeLabels) {
        const row = tbody.insertRow();
        const rangeCell = row.insertCell();
        rangeCell.textContent = rangeLabel.replace(/\d+:\s/, "");
        for (const armorLevel of armorLevels) {
            const damage = chartData[chartTitle][armorLevel][rangeLabel];
            const heatCell = row.insertCell();
            heatCell.classList.add("heat-cell")

            const color = getColorForValue(damage);
            heatCell.innerHTML = `<div class="heat-cell-color" style="background-color: ${color}">${damage.toFixed(1)}</div>`
        }
    }
}
function generateBestTypeTable(tableId, chartData) {
    const table = document.getElementById(tableId);
    table.innerHTML = '';
    const attackTypes = Object.keys(chartData);
    const armorLevels = Object.keys(chartData[attackTypes[0]]);
    const rangeLabels = Object.keys(chartData[attackTypes[0]]["Armor 0"]);

    // Create table header
    const thead = table.createTHead();
    const headerRow = thead.insertRow();
    headerRow.insertCell().textContent = "Range / Armor";
    for (const armorLevel of armorLevels) {
        const th = document.createElement('th');
        th.textContent = armorLevel.replace("Armor ", "");
        headerRow.appendChild(th);
    }

    const tbody = table.createTBody();
    for (const rangeLabel of rangeLabels) {
        const row = tbody.insertRow();
        const rangeCell = row.insertCell();
        rangeCell.textContent = rangeLabel.replace(/\d+:\s/, "");
        for (const armorLevel of armorLevels) {
            let bestType = "";
            let maxDamage = -Infinity;
            for (const attackType of attackTypes) {
                const damage = chartData[attackType][armorLevel][rangeLabel];
                if (damage > maxDamage) {
                    maxDamage = damage;
                    bestType = attackType.replace("Assault Rifle ", "").replace(" Shot", "");
                }
            }
            const bestCell = row.insertCell();
            bestCell.textContent = bestType;
        }
    }
}


function getColorForValue(value) {
    // Define a color range (you can customize this)
    const min = 0;
    const max = 180;
    // Ensure the value is within the range
    const clampedValue = Math.min(Math.max(value, min), max);
    // Calculate the normalized value (0 to 1)
    const normalizedValue = (clampedValue - min) / (max - min);
    // Convert normalized value to an HSL color with a consistent hue, adjusting lightness and saturation
    const hue = 240; // Blue hue
    const saturation = 100;
    const lightness = Math.round((1 - normalizedValue) * 70 + 30); // Lightness from 30 to 100, or a variation of the inverse of the value
    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}

const chartKeys = Object.keys(data);

generateHeatMapTable('table1', "Assault Rifle Single Shot", data);
generateHeatMapTable('table2', "Assault Rifle Autofire", data);
generateHeatMapTable('table3', "Assault Rifle Targeted Shot", data);
generateBestTypeTable('table4', data);